# Activity Summary for 9/23/2025

## 11:43:21 AM
The log shows a series of modifications to the `Week8.py` file and `stm_link.py` file between 9:43 AM and 11:33 AM on September 23, 2025.  The `Week8.py` file is the primary focus, representing a Raspberry Pi server application that interacts with an Android device and an STM32 microcontroller.

**Week8.py Changes Summary:**

The main evolution in `Week8.py` centers around enhancing the Android communication and adding API health checks. Initially, the code lacked a mechanism to verify the health of external APIs before sending commands.  Subsequent updates introduced a `check_api()` function and incorporated it within the `android_io_process` function to ensure API availability before sending a "Ready" status message to the Android app. The `check_api` function call was also added to the `start` function, which improved the initial API health check.  Furthermore, a `ready` flag was added to the `RaspberryPi` class to indicate the programâ€™s readiness after successful API checks.  Finally, some seemingly inconsequential changes were made such as adjusting the placement of `health_checked = False` and the addition of the `<` and `>` characters around the string "FR90" in the `recv_android` function.


**stm_link.py Changes Summary:**

The `stm_link.py` file, responsible for communication with the STM32 microcontroller, underwent minor changes. The primary modification was replacing a `while True` loop in the `connect` function with a `while True` loop that includes a `break` statement. This ensures that the loop terminates upon successful connection to the STM32, resulting in cleaner code.


**Recurring Elements and Patterns:**

* **Error Handling:** Extensive use of `try...except` blocks is seen throughout `Week8.py` to handle potential errors during various operations like camera initialization, serial communication, and JSON processing.
* **Multithreading/Multiprocessing:** The code extensively utilizes threads and processes for concurrent handling of Android communication, STM32 interaction, and camera operations.  `threading.Thread` and `multiprocessing.Process` are employed.  The use of  `multiprocessing.Manager` for shared resources between processes is a notable aspect of the code.
* **Queue-based Communication:**  Queues (`multiprocessing.Queue`) are used to facilitate communication between different threads/processes, ensuring safe data exchange.
* **Logging:**  The `prepare_logger()` function (from a presumably custom logger module) is used consistently for logging various events and debugging information.  This is an important feature in handling and debugging the system.
* **API Interaction:** The code interacts with remote servers (`IMAGE_SERVER`, `ALGO_SERVER`) which are likely image processing and path planning services, respectively.


**Significant Timestamps:**

* **9/23/2025, 9:49:27 AM:** The addition of a connection health check for the APIs was implemented.
* **9/23/2025, 9:53:23 AM:** Further refined the API health check within `android_io_process`.
* **9/23/2025, 11:06:13 AM & 11:08:55 AM:**  Minor modification of the commands sent to the STM32. "<FW10>" was added to accommodate a potentially changed command structure.
* **9/23/2025, 11:20:26 AM & 11:20:46 AM & 11:23:13 AM:**  The `check_api()` call was moved into the main function to improve the readiness check on start-up and cleanup.  Further simplification of the API health check was done.
* **9/23/2025, 11:29:57 AM & 11:30:05 AM:** Minor bug fixes in the `stm_link.py` file.  The `break` statement was added in the `connect()` method to clean up the loop.


The overall changes show a progressive improvement of the system's robustness and stability.  The addition of API health checks and the refinements to the Android communication and error handling are significant steps in making the application more reliable.


## 3:43:17 PM
The primary file modified is `Week8.py`, undergoing numerous revisions throughout the day on September 23, 2025.  The changes primarily center around the communication between a Raspberry Pi (RPi), an Android device, and an STM32 microcontroller.

The initial versions of `Week8.py` (12:12:16 PM and 12:13:57 PM) establish the core framework.  This includes setting up communication queues (`android_queue`, `rpi_action_queue`, `stm_queue`, `path_queue`), events (`android_stop_event`, `stm_done`), and processes for managing the Android connection.  The code handles camera operations (using `PiCamera` if available), STM32 communication (`STMLink`), and Android communication (`AndroidLink`). The `take_snapshot` function is implemented for capturing and saving images with error handling and robust file writing.  The `android_io_process` function manages the Android connection, receiving commands and sending updates.   There's a distinction made between RPi operating on a Raspberry Pi vs. a non-Raspberry Pi machine.

A significant change occurs around 1:19:37 PM, where the `start` method loses the `if self.check_api(): self.android_queue.put(AndroidMessage("status", "Ready to receive commands"))` line, suggesting a refactoring of the API check.  Further edits at 1:20:11 PM and 1:20:22 PM involve minor adjustments to the API check and thread handling within the `android_io_process` function, making the `check_api()` call to send "Ready to receive commands" only once.


Subsequent modifications (3:18:19 PM, 3:23:38 PM, 3:26:55 PM, 3:29:22 PM, 3:39:36 PM, 3:40:13 PM) focus on refining the Android communication.  The status message sent to the Android app changes from "Ready to receive commands" to "ready-to-roll".  A `bullseye` boolean variable is added, likely for tracking a specific event related to image recognition ("marker" image id). The final versions enhance the `send_android` function by including conditional logic to set `self.bullseye` based on the received 'image-rec' message type and its 'image-id'.

The `communication/stm_link.py` file is updated twice (1:24:31 PM and 1:26:32 PM).  The only noticeable difference is increased delay in STM32 connection retry from 2 seconds to 4 seconds. The file defines a class for serial communication with the STM32, specifying commands for both path and manual modes.

Finally, `server_receive_image.py` is updated twice (3:37:59 PM and 3:38:45 PM), primarily changing the key name from 'obstacle-id' to 'label' in the dictionary returned by the `/upload` endpoint. This file describes a Flask server for receiving and processing images, performing object detection, and drawing bounding boxes around detected objects.  The server saves both original and annotated images to disk.

In summary, the log shows iterative development focused on the integration and refinement of the RPi's communication with Android and STM32, along with image processing capabilities. The changes demonstrate a progression from initial setup to improved error handling and feature enhancements, especially in the communication between RPi and Android devices.


## 8:30:28 PM
The log shows multiple revisions of the `Week8.py` file, focusing on a Raspberry Pi-based system interacting with Android and an STM device.  The code manages communication between these components, image capture and processing, and path planning using external API calls.

The initial versions (3:43:50 PM, 3:44:09 PM, 3:45:14 PM, 3:45:24 PM) are essentially identical, indicating no significant changes in the core functionality during this period.

Subsequent commits introduced improvements and bug fixes:

* **3:46:41 PM:** A `logger.info('found bullseye')` statement was added to the `send_android` function, suggesting debugging or logging enhancement related to image recognition ("bullseye" likely signifies a target detection).

* **3:47:38 PM - 3:47:49 PM:** Minor modifications within the `send_android` function's exception handling, possibly related to Bluetooth communication stability.

* **3:56:55 PM:** No apparent changes from the previous version.


* **4:06:30 PM:** A minor correction in the `android_io_process` function; `AndroidMessage("status", "Failed to convert raw Android message:")` was changed to `AndroidMessage("status", "Failed to convert raw Android message")` - removing a trailing colon.


* **6:33:45 PM - 6:33:52 PM, 6:35:23 PM:** No substantial changes observable between these timestamps.

* **6:39:47 PM - 6:40:20 PM:**  A crucial addition to the `android_io_process` function:  If `self.check_api()` returns False (API check fails), an `AndroidMessage` with the status "API returned non 200 status code" is now sent to Android.  This significantly enhances error handling and reporting.

* **7:08:28 PM - 7:09:14 PM, 7:10:03 PM - 7:10:11 PM:**  These commits show very little or no difference between the versions, likely just minor edits.


* **7:12:28 PM - 7:13:46 PM:**  An exception handling was added into `send_android` function for bluetooth send failure.


* **7:19:42 PM:** The `rpi_queue_listener` function was significantly expanded, implementing image capture (`take_snapshot`), image upload to an `IMAGE_SERVER`, and feedback to the Android app. This introduces the core image processing and upload logic. The `take_snapshot` function also improved its error handling and image formatting.  The function now handles the "snap" command, uploads the image to a server, and sends the results back to Android.

* **7:24:33 PM - 7:25:00 PM:** No significant changes observed.

* **8:23:25 PM - 8:23:51 PM:** No substantial changes from the previous version.

* **8:25:20 PM - 8:25:32 PM:**  The `rpi_queue_listener` function was further modified to include a path queue (`self.path_queue`).  Commands received from the `ALGO_SERVER` are now put into this new queue. This separates path planning commands from other types of commands and better manages the flow of instructions.

* **8:28:12 PM - 8:28:19 PM:**  Import statements are reorganized for better readability and maintainability.  The code remains functionally identical.

* **8:28:51 PM - 8:29:02 PM, 8:29:26 PM:** Minor code formatting changes (import statement adjustments).


The overall pattern shows a process of incremental development and refinement. The code is structured to handle communication, image processing, and path planning in a robust manner.  The final version includes significant improvements in error handling and better organization of queues and tasks.
