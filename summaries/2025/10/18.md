# Activity Summary for 10/18/2025

## 3:56:15 PM
The code change log primarily details updates across three Python files, all located within `/Users/zhihao/Desktop/MDP_Shared/MDP-Maxxing/RPI_Vision_V2/`.

**File-Specific Updates:**

*   **`/Users/zhihao/Desktop/MDP_Shared/MDP-Maxxing/RPI_Vision_V2/server_receive_image2.py`**
    *   **Initial State (10/18/2025, 2:58:31 PM):** This file defines a Flask server for image recognition. It includes endpoints for `/status`, `/upload`, and `/stitch_images`. The `/upload` endpoint receives an image, decodes it using OpenCV, performs object detection using a loaded model, and then potentially annotates the image. Notably, it has specific logic to check for a "snap_2" form field and only annotates if the detected label is '38' or '39'. It runs on port 5001. It initially imported `PIL.Image` and `my_utils.send_annotated_images`.
    *   **Cleanup and Refinement (10/18/2025, 3:00:05 PM - 3:00:11 PM):** The `send_annotated_images` import was removed. A temporary typo in the `PIL` import (`fro` instead of `from PIL import Image`) was introduced and quickly corrected.
    *   **Further Cleanup (10/18/2025, 3:31:04 PM):** The `PIL.Image` import was entirely removed, suggesting it's no longer necessary for the server's operation. The core logic, including the "snap_2" check and conditional annotation for labels '38' or '39', remained consistent.

*   **`/Users/zhihao/Desktop/MDP_Shared/MDP-Maxxing/RPI_Vision_V2/model.py`**
    *   **Core Functionality (10/18/2025, 3:06:35 PM):** This file is responsible for the machine learning aspects. It contains functions to `load_model` (specifically YOLOv5, attempting to load from local source, cache, or cloning the repository), convert various image formats to BGR NumPy arrays (`_to_numpy_bgr`), retrieve label maps (`get_label_map`), and `predict_image_labels`. The prediction logic processes YOLOv5 results, extracts bounding boxes, confidences, and class IDs, and includes a specific filtering step to drop "marker" labels if multiple detections occur, then selects the detection with the largest bounding box area.
    *   **Minor Addition (10/18/2025, 3:06:58 PM):** The `pathlib` module was imported, and commented-out lines relating to `pathlib.PosixPath` for Windows compatibility were added, along with a clarifying comment. This indicates consideration for cross-platform execution, though the specific workaround remains disabled.

*   **`/Users/zhihao/Desktop/MDP_Shared/MDP-Maxxing/RPI_Vision_V2/server_receive_image.py`**
    *   **New Server Variant (10/18/2025, 3:30:43 PM):** This appears to be a separate, but very similar, Flask server file. Key differences from `server_receive_image2.py` are: it runs on port 5000, lacks the `snap_2` form field check, and unconditionally annotates any detected object (it does not filter for labels '38' or '39' for annotation). It initially imported `PIL.Image`, `io`, and `my_utils.send_annotated_images`.
    *   **Import Cleanup (10/18/2025, 3:31:12 PM - 3:31:28 PM):** Similar to `server_receive_image2.py`, `my_utils.send_annotated_images` was removed. Subsequently, the `io` module import was also removed. The `PIL.Image` import was retained in this file.

**Timestamps of Significant Changes:**

*   **10/18/2025, 3:00:05 PM - 3:00:11 PM:** `server_receive_image2.py` underwent initial import cleanup, specifically removing `send_annotated_images` and fixing a minor syntax error.
*   **10/18/2025, 3:06:58 PM:** `model.py` was updated to include `pathlib` and comments for potential Windows compatibility, highlighting attention to portability.
*   **10/18/2025, 3:31:04 PM:** `server_receive_image2.py` had a further import `PIL.Image` removed.
*   **10/18/2025, 3:31:12 PM - 3:31:28 PM:** `server_receive_image.py` had its own set of import cleanups, removing `send_annotated_images` and `io`.

**Patterns and Recurring Elements:**

*   **Server Duplication/Variation:** There are two distinct Flask server files (`server_receive_image.py` and `server_receive_image2.py`), each serving a similar purpose but with minor functional differences (e.g., port number, specific request handling logic, and annotation criteria). This suggests parallel development, A/B testing, or different deployment targets for these server configurations.
*   **Consistent Core Logic:** Both server files share a common structure: receiving images, using `cv2.imdecode` for processing, calling `predict_image_labels` from `model.py`, drawing bounding boxes, and saving results to a `results` folder with timestamps. Both also expose a `/status` and `/stitch_images` endpoint.
*   **Import Cleanup:** A recurring pattern is the removal of imports like `PIL.Image`, `io`, and `my_utils.send_annotated_images` across the server files. This indicates a general effort to streamline dependencies and clean up unused code, possibly reflecting a shift in how images are handled or processed downstream.
*   **Performance Monitoring:** Both server files include detailed `time.perf_counter()` measurements to log the duration of decoding, prediction, and saving steps, indicating a focus on optimizing execution speed.
*   **YOLOv5 Integration:** The `model.py` file demonstrates robust integration with YOLOv5, handling model loading, inference, and specific post-processing logic for detections (e.g., dropping "marker" labels and selecting the largest area).

## 10:01:15 PM
The provided log details changes to a single file: `/Users/zhihao/Desktop/MDP_Shared/MDP-Maxxing/RPI_Server/README.md`.

The initial state of the `README.md` file, established around 10/18/2025, 9:11:12 PM, provided a comprehensive overview of a Raspberry Pi 4 integration project. This project connects an RPi4 with an Android tablet (via Bluetooth SPP) and an STM32 microcontroller (via USB serial), managing image capture for obstacle detection and arrow recognition.

Key information present in this initial version included:
*   **Folder Overview**: Descriptions for `Week8.py` (general integration), `Week9.py` (specialized arrow detection), `logger.py`, `settings.py`, `requirements.txt`, and `logfile.txt`.
*   **Flow Summary**: A detailed four-step process outlining communication between Android, RPi4, Algo API, STM32, and an Image Recognition API. This included specific JSON formats for Android to RPi4 communication and command structures for RPi4 to Algo/STM32 interactions.
*   **Command Reference**: A list of commands like `<FWxxx>`, `<BWxxx>`, `<FLxxx>`, `<FRxxx>`, `<FIN>`, `<SNAPS>`, `<DONE>`, and `<ERR>`, along with their descriptions for controlling movement, triggering image capture, and acknowledging completion or errors.
*   **Detailed Operation**: Sections for `Week8.py` and `Week9.py`, explaining their respective roles. `Week9.py` was highlighted for its specific task of detecting only left/right arrows and sending corresponding `<LEFTS>` or `<RIGHT>` commands to the STM32, including logic for handling multiple captures for the second obstacle.

Between 9:11:12 PM and 9:11:47 PM on 10/18/2025, the file content remained identical, indicating no substantive changes were committed within this brief period.

A significant update occurred at 10/18/2025, 9:13:01 PM. At this point, a new "Requirements" section was appended to the `README.md`. This new section explicitly instructs users to install Python dependencies using `pip install -r requirements.txt`, enhancing the setup guidance for the project.

In summary, the changes primarily involved the initial creation of a detailed project `README.md` covering architecture, data flow, commands, and module responsibilities, followed by a specific addition of setup instructions for dependencies. The overall pattern reflects a progressive effort to document the RPI_Server component of the MDP-Maxxing project, focusing on operational details and then adding practical setup steps.